<div class="container mt-4">
  <h2 class="mb-4">Productos</h2>

  <div class="alert alert-success" *ngIf="mensaje">{{ mensaje }}</div>

  <!-- Filtros -->
  <div class="row mb-4">
    <div class="col-md-6">
      <input
        type="text"
        class="form-control"
        placeholder="Buscar productos..."
        [(ngModel)]="busqueda"
        (ngModelChange)="filtrarProductos()"
      >
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="categoriaSeleccionada" (ngModelChange)="filtrarProductos()">
        <option [value]="0">Todas las categor√≠as</option>
        <option *ngFor="let categoria of categorias" [value]="categoria.id">
          {{ categoria.nombre }}
        </option>
      </select>
    </div>
  </div>

  <!-- Loading -->
  <div class="text-center my-5" *ngIf="loading">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Lista de productos -->
  <div class="row" *ngIf="!loading">
    <div class="col-md-4 mb-4" *ngFor="let producto of productosFiltrados">
      <div class="card h-100 shadow-sm">
        <img
          [src]="producto.imagenUrl || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%23e9ecef%22 width=%22400%22 height=%22300%22/%3E%3Ctext fill=%22%236c757d%22 font-family=%22sans-serif%22 font-size=%2220%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3ESin Imagen%3C/text%3E%3C/svg%3E'"
          class="card-img-top"
          [alt]="producto.nombre"
          style="height: 250px; object-fit: cover;"
        >
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ producto.nombre }}</h5>
          <p class="card-text text-muted small">{{ producto.descripcion }}</p>
          <div class="mt-auto">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="h5 mb-0 text-primary">${{ producto.precio | number:'1.2-2' }}</span>
              <span class="badge bg-secondary">Stock: {{ producto.stock }}</span>
            </div>
            <div class="d-grid gap-2">
              <button
                class="btn btn-primary"
                (click)="agregarAlCarrito(producto)"
                [disabled]="producto.stock === 0"
              >
                <i class="bi bi-cart-plus"></i>
                {{ producto.stock === 0 ? 'Sin Stock' : 'Agregar al Carrito' }}
              </button>
              <a [routerLink]="['/productos', producto.id]" class="btn btn-outline-secondary btn-sm">
                Ver Detalles
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 text-center my-5" *ngIf="productosFiltrados.length === 0">
      <p class="text-muted">No se encontraron productos</p>
    </div>
  </div>
</div>
