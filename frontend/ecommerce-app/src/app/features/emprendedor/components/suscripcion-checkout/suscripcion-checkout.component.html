<div class="container py-4">
  <h2 class="mb-4">
    <i class="bi bi-credit-card me-2"></i>
    Suscribirse a un Plan
  </h2>

  <!-- Mensajes -->
  <div class="alert alert-danger" *ngIf="errorMessage">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ errorMessage }}
  </div>

  <div class="alert alert-success" *ngIf="successMessage">
    <i class="bi bi-check-circle me-2"></i>
    {{ successMessage }}
  </div>

  <!-- Loading -->
  <div class="text-center py-5" *ngIf="loading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2 text-muted">Cargando planes...</p>
  </div>

  <div class="row" *ngIf="!loading">
    <!-- Selección de Plan -->
    <div class="col-lg-7 mb-4">
      <div class="card shadow-sm" *ngIf="!selectedPlan">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Selecciona un Plan</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3" *ngFor="let plan of planes">
              <div class="card h-100 plan-card" (click)="seleccionarPlan(plan)">
                <div class="card-body text-center">
                  <h5 class="card-title">{{ plan.nombre }}</h5>
                  <p class="card-text text-muted small">{{ plan.descripcion }}</p>
                  <h3 class="text-primary mb-2">
                    {{ plan.precioMensual | currency:'ARS':'symbol':'1.0-0' }}
                    <small class="text-muted fs-6">/mes</small>
                  </h3>
                  <ul class="list-unstyled small">
                    <li><i class="bi bi-check text-success"></i> {{ plan.maxProductos }} productos</li>
                    <li><i class="bi bi-check text-success"></i> 7 días de prueba gratis</li>
                  </ul>
                  <button class="btn btn-outline-primary btn-sm mt-2">
                    Seleccionar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Formulario de Pago -->
      <div class="card shadow-sm" *ngIf="selectedPlan">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Datos de Pago</h5>
          <button class="btn btn-sm btn-outline-light" (click)="selectedPlan = null; cardForm = null">
            <i class="bi bi-arrow-left"></i> Cambiar plan
          </button>
        </div>
        <div class="card-body">
          <div class="alert alert-info mb-4">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Plan seleccionado:</strong> {{ selectedPlan.nombre }}
            - {{ selectedPlan.precioMensual | currency:'ARS':'symbol':'1.0-0' }}/mes
            <br>
            <small>Los primeros 7 días son gratis. Puedes cancelar en cualquier momento.</small>
          </div>

          <form id="card-form">
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                [(ngModel)]="payerEmail"
                name="payerEmail"
                placeholder="tu@email.com"
              />
              <small class="text-muted">Recibirás confirmaciones de pago en este email</small>
            </div>

            <div class="mb-3">
              <label class="form-label">Número de Tarjeta</label>
              <div id="card-number" class="mp-input"></div>
            </div>

            <div class="row">
              <div class="col-6 mb-3">
                <label class="form-label">Vencimiento</label>
                <div id="expiration-date" class="mp-input"></div>
              </div>
              <div class="col-6 mb-3">
                <label class="form-label">CVV</label>
                <div id="security-code" class="mp-input"></div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Nombre en la Tarjeta</label>
              <div id="cardholder-name" class="mp-input"></div>
            </div>

            <div class="row">
              <div class="col-4 mb-3">
                <label class="form-label">Tipo Doc.</label>
                <select id="identification-type" class="form-select"></select>
              </div>
              <div class="col-8 mb-3">
                <label class="form-label">Número de Documento</label>
                <div id="identification-number" class="mp-input"></div>
              </div>
            </div>

            <div class="d-grid gap-2 mt-4">
              <button
                type="submit"
                class="btn btn-success btn-lg"
                [disabled]="procesando"
              >
                <span *ngIf="procesando" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!procesando" class="bi bi-lock me-2"></i>
                {{ procesando ? 'Procesando...' : 'Suscribirme' }}
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="cancelar()"
                [disabled]="procesando"
              >
                Cancelar
              </button>
            </div>
          </form>

          <div class="text-center mt-4">
            <img src="https://www.mercadopago.com/org-img/Manual/ManualMP/imgs/isologoHorizontal.png"
                 alt="MercadoPago" height="30" class="me-2">
            <small class="text-muted">Pago seguro con MercadoPago</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumen -->
    <div class="col-lg-5">
      <div class="card shadow-sm sticky-top" style="top: 20px;">
        <div class="card-header bg-light">
          <h5 class="mb-0">Resumen</h5>
        </div>
        <div class="card-body" *ngIf="selectedPlan">
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item d-flex justify-content-between">
              <span>Plan {{ selectedPlan.nombre }}</span>
              <strong>{{ selectedPlan.precioMensual | currency:'ARS':'symbol':'1.0-0' }}</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between text-success">
              <span>Descuento período de prueba</span>
              <strong>-{{ selectedPlan.precioMensual | currency:'ARS':'symbol':'1.0-0' }}</strong>
            </li>
          </ul>
          <hr>
          <div class="d-flex justify-content-between mb-2">
            <strong>Hoy pagas:</strong>
            <strong class="text-success fs-4">$0</strong>
          </div>
          <small class="text-muted">
            Después de 7 días se cobrará {{ selectedPlan.precioMensual | currency:'ARS':'symbol':'1.0-0' }}/mes
          </small>
        </div>
        <div class="card-body text-center text-muted" *ngIf="!selectedPlan">
          <i class="bi bi-cart" style="font-size: 3rem;"></i>
          <p class="mt-2">Selecciona un plan para ver el resumen</p>
        </div>
        <div class="card-footer bg-light">
          <small>
            <i class="bi bi-shield-check text-success me-1"></i>
            Puedes cancelar en cualquier momento
          </small>
        </div>
      </div>
    </div>
  </div>
</div>
