<div class="container mt-4">
  <h2 class="mb-4">Carrito de Compras</h2>

  <div class="alert alert-info" *ngIf="mensaje">{{ mensaje }}</div>

  <div class="text-center my-5" *ngIf="loading">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <div *ngIf="!loading && items.length === 0" class="text-center my-5">
    <i class="bi bi-cart-x" style="font-size: 4rem; color: #ccc;"></i>
    <h3 class="mt-3">Tu carrito está vacío</h3>
    <p class="text-muted">Agrega productos para comenzar a comprar</p>
    <a routerLink="/productos" class="btn btn-primary mt-3">Ver Productos</a>
  </div>

  <div class="row" *ngIf="!loading && items.length > 0">
    <div class="col-lg-8">
      <div class="card mb-3" *ngFor="let item of items">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-2">
              <img
                [src]="item.productoImagen || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23e9ecef%22 width=%22100%22 height=%22100%22/%3E%3Ctext fill=%22%236c757d%22 font-family=%22sans-serif%22 font-size=%2214%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3EProducto%3C/text%3E%3C/svg%3E'"
                [alt]="item.productoNombre"
                class="img-fluid rounded"
              >
            </div>
            <div class="col-md-4">
              <h5 class="mb-1">{{ item.productoNombre }}</h5>
            </div>
            <div class="col-md-2 text-center">
              <p class="mb-0 fw-bold">${{ item.precioUnitario | number:'1.2-2' }}</p>
            </div>
            <div class="col-md-2">
              <div class="input-group input-group-sm">
                <button
                  class="btn btn-outline-secondary"
                  (click)="actualizarCantidad(item, item.cantidad - 1)"
                  [disabled]="item.cantidad <= 1"
                >
                  <i class="bi bi-dash"></i>
                </button>
                <input
                  type="number"
                  class="form-control text-center"
                  [value]="item.cantidad"
                  readonly
                >
                <button
                  class="btn btn-outline-secondary"
                  (click)="actualizarCantidad(item, item.cantidad + 1)"
                >
                  <i class="bi bi-plus"></i>
                </button>
              </div>
            </div>
            <div class="col-md-2 text-end">
              <p class="mb-2 fw-bold text-primary">
                ${{ item.subtotal | number:'1.2-2' }}
              </p>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="eliminarItem(item.id)"
              >
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-3">
        <button class="btn btn-outline-secondary" routerLink="/productos">
          <i class="bi bi-arrow-left"></i> Seguir Comprando
        </button>
        <button class="btn btn-outline-danger" (click)="vaciarCarrito()">
          <i class="bi bi-trash"></i> Vaciar Carrito
        </button>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card sticky-top" style="top: 20px;">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Resumen del Pedido</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-2">
            <span>Productos ({{ cantidadTotal }})</span>
            <span>${{ total | number:'1.2-2' }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Envío</span>
            <span class="text-success">Gratis</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-3">
            <strong>Total</strong>
            <strong class="text-primary h4">${{ total | number:'1.2-2' }}</strong>
          </div>
          <button
            class="btn btn-primary w-100 btn-lg"
            (click)="irACheckout()"
          >
            Proceder al Pago
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
